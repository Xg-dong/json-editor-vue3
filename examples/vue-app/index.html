<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Editor Vue3 - 真实组件示例</title>
    <script type="importmap">
    {
      "imports": {
        "vue": "https://unpkg.com/vue@3/dist/vue.esm-browser.js",
        "element-plus": "https://unpkg.com/element-plus@2/dist/index.esm.js",
        "monaco-editor": "https://unpkg.com/monaco-editor@0.50.0/esm/vs/editor/editor.api.js",
        "@element-plus/icons-vue": "https://unpkg.com/@element-plus/icons-vue@2/dist/index.js"
      }
    }
  </script>
  <script>
    // 配置 Monaco Editor Web Worker
    window.MonacoEnvironment = {
      getWorkerUrl: function (moduleId, label) {
        if (label === 'json') {
          return 'data:text/javascript;charset=utf-8,' + encodeURIComponent(`
            self.MonacoEnvironment = {
              baseUrl: 'https://unpkg.com/monaco-editor@0.50.0/min/'
            };
            importScripts('https://unpkg.com/monaco-editor@0.50.0/min/vs/language/json/json.worker.js');
          `);
        }
        return 'data:text/javascript;charset=utf-8,' + encodeURIComponent(`
          self.MonacoEnvironment = {
            baseUrl: 'https://unpkg.com/monaco-editor@0.50.0/min/'
          };
          importScripts('https://unpkg.com/monaco-editor@0.50.0/min/vs/editor/editor.worker.js');
        `);
      }
    };
  </script>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css" />
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .app-header {
            background: linear-gradient(135deg, #409eff, #67c23a);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .app-content {
            padding: 30px;
        }

        .demo-section {
            margin-bottom: 40px;
            border: 1px solid #e4e7ed;
            border-radius: 6px;
            overflow: hidden;
        }

        .demo-header {
            background: #f5f7fa;
            padding: 20px;
            border-bottom: 1px solid #e4e7ed;
            font-weight: 600;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .demo-content {
            padding: 30px;
        }

        .control-panel {
            background: #fafbfc;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .control-row {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .control-row:last-child {
            margin-bottom: 0;
        }

        .control-label {
            font-weight: 500;
            min-width: 100px;
        }

        .editor-container {
            border: 1px solid #dcdfe6;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .status-panel {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 12px;
        }

        .log-panel {
            max-height: 300px;
            overflow-y: auto;
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 12px;
            line-height: 1.5;
        }

        .log-entry {
            margin-bottom: 5px;
            word-break: break-word;
        }

        .log-timestamp {
            color: #718096;
        }

        .log-type-info {
            color: #63b3ed;
        }

        .log-type-success {
            color: #68d391;
        }

        .log-type-warning {
            color: #fbb040;
        }

        .log-type-error {
            color: #f56565;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .data-display {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            .control-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .control-label {
                min-width: auto;
            }

            .button-group {
                justify-content: center;
            }
        }
    </style>
</head>

<body>
    <div id="app">
        <div class="app-container">
            <div class="app-header">
                <h1>🎯 JSON Editor Vue3 真实组件示例</h1>
                <p>完全基于 JsonEditor.vue 组件和相关工具函数的功能演示</p>
            </div>

            <div class="app-content">
                <!-- 基础功能演示 -->
                <div class="demo-section">
                    <div class="demo-header">
                        <span>📝 基础功能演示</span>
                        <el-button-group size="small">
                            <el-button @click="resetBasicDemo">重置</el-button>
                            <el-button @click="loadSampleData" type="primary">加载示例</el-button>
                        </el-button-group>
                    </div>
                    <div class="demo-content">
                        <div class="control-panel">
                            <div class="control-row">
                                <span class="control-label">组件配置:</span>
                                <el-switch v-model="basicConfig.readonly" active-text="只读模式" />
                                <el-switch v-model="basicConfig.autoFormat" active-text="自动格式化" />
                                <el-switch v-model="basicConfig.showFormatButton" active-text="格式化按钮" />
                                <el-switch v-model="basicConfig.showFullscreenButton" active-text="全屏按钮" />
                            </div>
                            <div class="control-row">
                                <span class="control-label">主题:</span>
                                <el-radio-group v-model="basicConfig.theme">
                                    <el-radio value="light">浅色</el-radio>
                                    <el-radio value="dark">深色</el-radio>
                                </el-radio-group>
                            </div>
                            <div class="control-row">
                                <span class="control-label">高度:</span>
                                <el-input-number v-model="basicConfig.height" :min="200" :max="600" />
                                <span>px</span>
                            </div>
                        </div>

                        <div class="editor-container">
                            <json-editor ref="basicEditor" v-model="basicData" :readonly="basicConfig.readonly"
                                :theme="basicConfig.theme" :height="basicConfig.height"
                                :auto-format="basicConfig.autoFormat" :show-format-button="basicConfig.showFormatButton"
                                :show-fullscreen-button="basicConfig.showFullscreenButton"
                                @focus="onEditorEvent('basic', 'focus')" @blur="onEditorEvent('basic', 'blur')"
                                @format="onEditorEvent('basic', 'format')"
                                @fullscreen="onEditorEvent('basic', 'fullscreen', $event)"
                                @update:error="onEditorError('basic', $event)" />
                        </div>

                        <div class="button-group">
                            <el-button @click="callEditorMethod('basic', 'format')" type="primary">格式化</el-button>
                            <el-button @click="callEditorMethod('basic', 'focus')" type="info">聚焦</el-button>
                            <el-button @click="callEditorMethod('basic', 'validate')" type="success">验证</el-button>
                            <el-button @click="callEditorMethod('basic', 'reset')" type="warning">重置</el-button>
                            <el-button @click="callEditorMethod('basic', 'toggleFullscreen')"
                                type="info">全屏切换</el-button>
                            <el-button @click="getEditorValue('basic')" type="success">获取值</el-button>
                            <el-button @click="setRandomValue('basic')" type="primary">设置随机值</el-button>
                        </div>
                    </div>
                </div>

                <!-- 高级功能演示 -->
                <div class="demo-section">
                    <div class="demo-header">
                        <span>🔧 高级功能演示 - 字段路径和只读</span>
                        <el-button @click="resetAdvancedDemo" size="small">重置</el-button>
                    </div>
                    <div class="demo-content">
                        <div class="control-panel">
                            <div class="control-row">
                                <span class="control-label">可见路径:</span>
                                <el-input v-model="visiblePathsInput" placeholder="例如: user.name,user.profile.email"
                                    style="width: 300px;" />
                                <el-button @click="applyVisiblePaths" size="small">应用</el-button>
                                <el-switch v-model="advancedConfig.visiblePathsExclude" active-text="排除模式" />
                            </div>
                            <div class="control-row">
                                <span class="control-label">只读路径:</span>
                                <el-input v-model="readonlyPathsInput" placeholder="例如: user.id,system.version"
                                    style="width: 300px;" />
                                <el-button @click="applyReadonlyPaths" size="small">应用</el-button>
                            </div>
                            <div class="control-row">
                                <span class="control-label">严格模式:</span>
                                <el-switch v-model="advancedConfig.strict" active-text="启用" />
                            </div>
                        </div>

                        <div class="editor-container">
                            <json-editor ref="advancedEditor" v-model="advancedData" :height="400"
                                :visible-paths="advancedConfig.visiblePaths"
                                :visible-paths-exclude="advancedConfig.visiblePathsExclude"
                                :readonly-paths="advancedConfig.readonlyPaths" :strict="advancedConfig.strict"
                                @update:error="onEditorError('advanced', $event)" />
                        </div>

                        <div class="button-group">
                            <el-button @click="loadComplexData" type="primary">加载复杂数据</el-button>
                            <el-button @click="testVisiblePaths" type="info">测试可见路径</el-button>
                            <el-button @click="testReadonlyPaths" type="warning">测试只读路径</el-button>
                            <el-button @click="mergeFields" type="success">合并字段测试</el-button>
                        </div>
                    </div>
                </div>

                <!-- 工具函数演示 -->
                <div class="demo-section">
                    <div class="demo-header">
                        <span>🛠️ 工具函数演示</span>
                        <el-button @click="clearLogs" size="small">清空日志</el-button>
                    </div>
                    <div class="demo-content">
                        <div class="button-group">
                            <el-button @click="testPickFields" type="primary">测试 pickFieldsSuper</el-button>
                            <el-button @click="testMergeFields" type="success">测试 mergeFieldsSuper</el-button>
                            <el-button @click="testReadonlyRanges" type="info">测试只读范围</el-button>
                            <el-button @click="testReadonlyValidation" type="warning">测试只读验证</el-button>
                        </div>

                        <div class="status-panel">
                            <strong>当前数据状态:</strong><br>
                            基础编辑器值: {{ JSON.stringify(basicData) }}<br>
                            高级编辑器值: {{ JSON.stringify(advancedData) }}<br>
                            最后操作: {{ lastOperation }}
                        </div>
                    </div>
                </div>

                <!-- 日志面板 -->
                <div class="demo-section">
                    <div class="demo-header">
                        <span>📋 操作日志</span>
                        <el-button-group size="small">
                            <el-button @click="clearLogs">清空</el-button>
                            <el-button @click="exportLogs">导出</el-button>
                        </el-button-group>
                    </div>
                    <div class="demo-content">
                        <div class="log-panel" ref="logPanel">
                            <div v-for="log in logs" :key="log.id" class="log-entry">
                                <span class="log-timestamp">[{{ log.time }}]</span>
                                <span :class="'log-type-' + log.type">[{{ log.type.toUpperCase() }}]</span>
                                {{ log.message }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="./app.js"></script>
</body>

</html>